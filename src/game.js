// Generated by CoffeeScript 1.3.3
(function() {
  var _ref;

  if ((_ref = window.SNAKE) == null) {
    window.SNAKE = {};
  }

  SNAKE.Game = (function() {

    function Game(settings) {
      var defaults, option, value;
      defaults = {
        debugPrint: false,
        debugStep: false
      };
      for (option in defaults) {
        value = defaults[option];
        this[option] = value;
        if (settings[option]) {
          this[option] = settings[option];
        }
      }
      this.snake = new SNAKE.Snake(this);
      this.grid = new SNAKE.Grid(this, this.snake);
      this.graphics = new SNAKE.Graphics(this, this.grid);
      this._startGame();
    }

    Game.prototype._startGame = function() {
      this.grid.foodCount = 0;
      this.grid.foodItems = new SNAKE.FoodQueue(this.grid);
      this.snake.setup(this.grid);
      this.grid.dropFood();
      clearInterval(this.grid.gameIntervalID);
      if (this.debugStep) {
        return this.setupGameStep();
      }
      this.grid.gameIntervalID = setInterval(this._gameLoop, this.grid.timeStepRate);
      return this._gameLoop();
    };

    Game.prototype._gameLoop = function() {
      this.snake.move();
      return this.graphics.update();
    };

    Game.prototype.setupGameStep = function() {
      var _this = this;
      $(window).keydown(function(event) {
        if (event.keyCode === 83) {
          return _this._gameLoop();
        }
      });
      return console.warn('Debug stepping is active. Press s to move a time step.');
    };

    Game.prototype.log = function(message) {
      if (!this.debugPrint) {
        return;
      }
      return console.log(message);
    };

    return Game;

  })();

}).call(this);
